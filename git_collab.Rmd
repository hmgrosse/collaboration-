---
title: "(add something catchy here):U.S. Housing Prices and the Impact of Natural Disasters"
author: "Jonah Brumback, Hannah Grosse, and Jon Kazor"
date: "4/12/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)     
library(gardenR)      
library(lubridate)   
library(openintro)     
library(patchwork)    
library(rvest)        
library(robotstxt)  
library(janitor)    
library(maps)        
library(ggmap)        
library(gplots)       
library(RColorBrewer) 
library(sf)          
library(leaflet)       
library(ggthemes)     
library(plotly)       
library(gganimate)    
library(transformr)   
library(gifski)      
library(shiny)
library(ggrepel)
theme_set(theme_minimal())
```

## U.S. Housing Prices


Housing in the United States plays a crucial role in the state of our economy. As housing prices reflect neighborhood value, the money poured into housing directly impacts other essential aspects of community development. Things like green space, schools, and public transit all hold significant impacts on the desirability of neighborhoods, thus directly affecting housing prices and public funding. 
	Americans are currently facing a national surge in housing prices. According to Pew Research Center, nearly 50% of Americans say that affordable housing has become a major problem. While this issue can be seen all across the country and across all age demographics, the problem is most prevalent among young people in urban areas. Cities like New York, Los Angeles, and Boston have become almost completely unaffordable for someone working an entry or lower-level job, forcing people to expand further and further outside city lines. 
	Despite this vast need for more homes, government spending tends to cater to amenities in already wealthy neighborhoods, rather than affordable units in newly gentrified and increasingly inaccessible areas. Rather than focusing on building more duplexes, affordable apartments, mother-in-law units, and other diverse housing options, we have seen a rapid rise in the gentrification-core buildings that we now know all too well (pictured). 

!(Gentrification-Core Building Example)[building_ds.png] 

```{r}
onebed_rent <- read_csv("City_MedianRentalPrice_1Bedroom.csv")
state_price <- read_csv("Sale_Prices_State.csv")

state_price_averages <- state_price %>% 
  mutate( "2008" = rowMeans(select(.,`2008-03`:`2008-12`)), na.rm=TRUE,
          "2009" = rowMeans(select(.,`2009-01`:`2009-12`)), na.rm=TRUE,
          "2010" = rowMeans(select(.,`2010-01`:`2010-12`)), na.rm=TRUE,
          "2011" = rowMeans(select(.,`2011-01`:`2011-12`)), na.rm=TRUE,
          "2012" = rowMeans(select(.,`2012-01`:`2012-12`)), na.rm=TRUE,
          "2013" = rowMeans(select(.,`2013-01`:`2013-12`)), na.rm=TRUE,
          "2014" = rowMeans(select(.,`2014-01`:`2014-12`)), na.rm=TRUE,
          "2015" = rowMeans(select(.,`2015-01`:`2015-12`)), na.rm=TRUE,
          "2016" = rowMeans(select(.,`2016-01`:`2016-12`)), na.rm=TRUE,
          "2017" = rowMeans(select(.,`2017-01`:`2017-12`)), na.rm=TRUE,
          "2018" = rowMeans(select(.,`2018-01`:`2018-12`)), na.rm=TRUE,
          "2019" = rowMeans(select(.,`2019-01`:`2019-12`)), na.rm=TRUE) %>% 
  select(RegionName, "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019")

mean_price_year <- state_price_averages %>% 
  pivot_longer(cols = -RegionName,
    names_to = "years")
```


  Pictured in an animated map below, we can see the upward trend of housing prices across the US. With the darker shades representing higher prices, it is clear that states with more densely populated, urban areas, have higher housing prices. Additionally, you can see that the upward trend of prices spreads across the entirety of the US, emphasizing the need for increased housing nationwide. 

```{r, fig.alt= "This animated graph shows the average sale price of houses, by state, for each year 2008-2019. The most expensive homes were consistently found in California each year, and the most inexpensive homes are are found in Oklahoma. The more expensive the average price, the darker it is. The average sale price increases for most homes over this time period. When there is no data the states are gray."}

states_map<- map_data("state") 

state_price_year <- mean_price_year %>% 
  mutate(RegionName = str_to_lower(`RegionName`)) %>% 
  group_by(years) %>% 
  arrange(years) %>% 
  ggplot() + 
  geom_map(map = states_map,
           aes(map_id = RegionName,
               fill = value,
               group = years),
               na.rm = TRUE) +
  labs(title = "Average State House Sale Price by Year", 
       subtitle = "Year: {closest_state}",
       fill = "Average Sale Price", 
       caption = "Graph by Hannah, Jonah, & Jon, data from Zillow, map from map_data") +
  expand_limits(x = states_map$long, y = states_map$lat) + 
  scale_fill_viridis_c(option = "rocket", direction = -1, labels = scales::comma) +
  #scale_fill_continuous(labels=scales::comma)+
  theme_map() + 
  theme(legend.background = element_blank()) +
 transition_states(years, transition_length = 0)

state_price_year

animate(state_price_year, nframes = 200, end_pause = 10) 

```

```{r}
anim_save("state_price_year.gif")
```


```{r}
knitr::include_graphics("state_price_year.gif")
```


(talk about graph above here)

With this data, we also wanted to explore the impact of natural disasters on housing prices. Hurricanes, tornados, and wildfires all drastically impact housing availability and therefore are directly tied to the housing market. While of course there are many other factors that impact housing prices, we thought it would be really interesting to look at the years before and after major natural disasters in the US to see how the housing market could have been impacted.
	Pictures below is a graph showing the housing prices for states all along the east coast before and after Hurricane Sandy. This 2012 hurricane lasted from October 22nd to November 2nd and caused over $65 billion dollars in damages nationwide. With most of its impact being concentrated on the east coast, we can see the effect of the storm on housing availability. Among all of the states affected, New York and New Jersey were hit the hardest and faced a massive loss of homes and infrastructure. 
	Next, we wanted to examine the effect of the 2018 California wildfires. These fires were the worst in California history, destroying more than 18,000 structures and causing $16.5 billion in damages. 
	Finally, in order to examine a diverse selection of natural disasters, we looked into the 2011 tornado super outbreak that spread across the Southeast US. Over the course of 3 days from August 25 to 28, there were 360 tornados across Alabama, Mississippi, Tennessee, Arkansas, Georgia, Kentucky, Louisiana, Virginia, and New York. About half were concentrated in Alabama, Mississippi, and Tennessee, and these states saw the most damage from the outbreak. A graph depicting the change in housing prices during this time is shown below. 

```{r, fig.width = 14, fig.height = 5, fig.alt = "This is a line graph showing the average sale price for each state, by month. The months included span from June 2012, to June 2013. The states included are Florida, Georgia, South Carolina, North Carolina, Virginia, Maryland, Deleware, Pennsylvania, New Jersey, New York, Connceticut, Rhode Island, Massacheusettes, New Hampshire, and Maine. There is a dot at Octocber, 2012, to indicate the time when Hurricane Sandy hit these states. The sale price for most states have minimal change with some states slightly increasing and some states slightly decreasing, and others remaining constant."}

price_by_month <- state_price %>% 
  pivot_longer(cols = -c("RegionName", "...1", "RegionID", "SizeRank"),
    names_to = "month_average") %>% 
  select(RegionName, month_average, value)

data_for_sandy <- price_by_month %>% 
  filter(RegionName == c("florida", "georgia", "south carolina", "north carolina", "virginia", "maryland", "deleware", "pennsylvania", "new jersey", "new york", "connceticut", "rhode island", "massacheusettes", "new hampshire", "maine"))

sandy_labels <- price_by_month %>% 
   mutate(RegionName = str_to_lower(`RegionName`), 
         na.rm = TRUE) %>% 
  group_by(month_average) %>% 
  arrange(month_average) %>%
  filter(month_average == "2013-06",
         RegionName %in% c("florida", "georgia", "south carolina", "north carolina", "virginia", "maryland", "deleware", "pennsylvania", "new jersey", "new york", "connceticut", "rhode island", "massacheusettes", "new hampshire", "maine"))

sandy_points <- price_by_month %>% 
   mutate(RegionName = str_to_lower(`RegionName`), 
         na.rm = TRUE) %>% 
  group_by(month_average) %>% 
  arrange(month_average) %>%
  filter(month_average == "2012-10",
         RegionName %in% c("florida", "georgia", "south carolina", "north carolina", "virginia", "maryland", "deleware", "pennsylvania", "new jersey", "new york", "connceticut", "rhode island", "massacheusettes", "new hampshire", "maine"))

hurricane_sandy <- price_by_month %>% 
  mutate(RegionName = str_to_lower(`RegionName`), 
         na.rm = TRUE) %>% 
  group_by(month_average) %>% 
  arrange(month_average) %>%
  filter(month_average %in% c("2012-06","2012-07","2012-08","2012-09","2012-10","2012-11","2012-12","2013-01","2013-02","2013-03","2013-04","2013-05","2013-06"),
    RegionName %in% c("florida", "georgia", "south carolina", "north carolina", "virginia", "maryland", "deleware", "pennsylvania", "new jersey", "new york", "connceticut", "rhode island", "massacheusettes", "new hampshire", "maine")) %>% 
  ggplot(aes(y = value, 
             x = month_average,
             group = RegionName,
             color = RegionName)) +
  geom_line() +
  geom_point(data = sandy_points, color = "black", size = 1.5) + 
  labs(title = "Average State Sale Price by Month",
      x = "",
      y = "Average House Price",
      color = "State",
      fill = "Average Sale Price by Month", 
      caption = "Graph by Hannah, Jonah, & Jon, data from Zillow") +
  geom_label_repel(data = sandy_labels,
                   aes(label = RegionName),
                   na.rm = TRUE) +
  theme(legend.position = "none")

hurricane_sandy
```


```{r, fig.height = 5, fig.width = 13, fig.alt = This is a line graph showing the average sale price for each state, by month. The months included span from January 2018, to December 2019. The states included are California, Oregon, and Washington. There is a dot at July and August 2018, to indicate the time when the wildfires occured. The sale price for most states have minimal change with Oregon slightly increasing in sale price, Washington slightly decreasing in sale price, and California remaining constant.}
wildfire_labels <- price_by_month %>% 
   mutate(RegionName = str_to_lower(`RegionName`), 
         na.rm = TRUE) %>% 
  group_by(month_average) %>% 
  arrange(month_average) %>%
  filter(month_average == "2019-12",
         RegionName %in% c("california", "oregon", "washington"))

wildfire_points <- price_by_month %>% 
   mutate(RegionName = str_to_lower(`RegionName`), 
         na.rm = TRUE) %>% 
  group_by(month_average) %>% 
  arrange(month_average) %>%
  filter(month_average %in% c("2018-07","2018-08"),
         RegionName %in% c("california", "oregon", "washington"))


wildfires <- price_by_month %>% 
  mutate(RegionName = str_to_lower(`RegionName`), 
         na.rm = TRUE) %>% 
  group_by(month_average) %>% 
  arrange(month_average) %>%
  filter(month_average %in% c("2018-01","2018-02","2018-03","2018-04","2018-05","2018-06","2018-07","2018-08","2018-09","2018-10","2018-11","2018-12","2019-01","2019-02","2019-03","2019-04","2019-05","2019-06","2019-07","2019-08","2019-09","2019-10","2019-11","2019-12"),
    RegionName %in% c("california", "oregon", "washington")) %>% 
   ggplot(aes(y = value, 
             x = month_average,
             group = RegionName,
             color = RegionName)) +
  geom_line() +
  geom_point(data = wildfire_points, color = "black", size = 1.5) + 
  labs(title = "Average State Sale Price by Month",
      x = "",
      y = "Average House Sale Price",
      color = "State",
      fill = "Average Sale Price by Month", 
      caption = "Graph by Hannah, Jonah, & Jon, data from Zillow") +
  geom_label_repel(data = wildfire_labels,
                   aes(label = RegionName),
                   na.rm = TRUE) +
  theme(legend.position = "none")

wildfires
```



```{r, fig.width = 9, fig.height = 5, fig.alt= "This is a line graph showing the average sale price for each state, by month. The months included span from March 2017, to March 2018. The state included is Texas. There is a dot at August and September, 2017, to indicate the time when Hurricane Harvey hit these states. The sale price for most states have minimal change with some states slightly increasing and some states slightly decreasing, and others remaining constant."}
 
harvey_points <- price_by_month %>% 
   mutate(RegionName = str_to_lower(`RegionName`), 
         na.rm = TRUE) %>% 
  group_by(month_average) %>% 
  arrange(month_average) %>%
  filter(month_average %in% c("2017-08","2017-09"),
         RegionName == "texas")


hurricane_harvey <- price_by_month %>% 
  mutate(RegionName = str_to_lower(`RegionName`), 
         na.rm = TRUE) %>% 
  group_by(month_average) %>% 
  arrange(month_average) %>% 
  filter(RegionName == "texas",
         month_average %in% c("2017-03","2017-04","2017-05","2017-06","2017-07","2017-08","2017-09","2017-10","2017-11","2017-12","2018-01","2018-02","2018-03")) %>% 
   ggplot(aes(y = value, 
             x = month_average,
             group = RegionName,
             color = RegionName)) +
  geom_line(color = "orange") +
  geom_point(data = harvey_points, color = "black", size = 1.5) + 
  labs(title = "Average Texas Sale Price by Month",
      x = "",
      y = "Average House Price",
      color = "State",
      fill = "Average Sale Price by Month",
      caption = "Graph by Hannah, Jonah, & Jon, data from Zillow") +
  theme(legend.position = "right")

hurricane_harvey
```


```{r, fig.height = 5, fig.width = 13}
tornado_labels <- price_by_month %>% 
   mutate(RegionName = str_to_lower(`RegionName`), 
         na.rm = TRUE) %>% 
  group_by(month_average) %>% 
  arrange(month_average) %>%
  filter(month_average == "2012-04",
         RegionName %in% c("alabama", "mississippi", "tennessee", "arkansas", "virginia", "georgia", "kentucky", "louisiana", "new york"))

tornado_points <- price_by_month %>% 
   mutate(RegionName = str_to_lower(`RegionName`), 
         na.rm = TRUE) %>% 
  group_by(month_average) %>% 
  arrange(month_average) %>%
  filter(month_average == "2011-08",
         RegionName %in% c("alabama", "mississippi", "tennessee", "arkansas", "virginia", "georgia", "kentucky", "louisiana", "new york"))

tornado_outbreak <- price_by_month %>% 
  mutate(RegionName = str_to_lower(`RegionName`), 
         na.rm = TRUE) %>% 
  group_by(month_average) %>% 
  arrange(month_average) %>%
  filter(month_average %in% c("2011-04","2011-05","2011-06","2011-07","2011-08","2011-09","2011-10","2011-11","2011-12","2012-01","2012-02","2012-03","2012-04"),
    RegionName %in% c("alabama", "mississippi", "tennessee", "arkansas", "virginia", "georgia", "kentucky", "louisiana", "new york")) %>% 
    ggplot(aes(y = value, 
             x = month_average,
             group = RegionName,
             color = RegionName)) +
  geom_line() +
  geom_point(data = tornado_points, color = "black", size = 1.5) + 
  labs(title = "Average State Sale Price by Month",
      x = "",
      y = "Average House Price",
      color = "State",
      fill = "Average Sale Price by Month", 
      caption = "Graph by Hannah, Jonah, & Jon, data from Zillow") +
  geom_label_repel(data = tornado_labels,
                   aes(label = RegionName),
                   na.rm = TRUE) +
  theme(legend.position = "none")

tornado_outbreak
```



```{r}
city_prices <- read_csv("Sale_Prices_City.csv")
```
```{r, fig.height=5, fig.width = 9}
city_data <- city_prices %>% 
  pivot_longer(cols = -c("StateName", "RegionName", "...1", "RegionID", "SizeRank"),
    names_to = "month_average") %>% 
  select(RegionName, month_average, value)

bombing_points <- city_data %>% 
   mutate(RegionName = str_to_lower(`RegionName`), 
         na.rm = TRUE) %>% 
  group_by(month_average) %>% 
  arrange(month_average) %>%
  filter(month_average == "2013-04",
         RegionName == "boston")

boston_bombing <- city_data %>% 
  mutate(RegionName = str_to_lower(`RegionName`), 
         na.rm = TRUE) %>%
  filter(RegionName == "boston",
         month_average %in% c("2013-01","2013-02","2013-03","2013-04","2013-05","2013-06","2013-07","2013-08","2013-09","2013-10","2013-11","2013-12","2014-01","2014-02","2014-03","2014-04")) %>% 
  ggplot(aes(y = value, 
             x = month_average,
             group = RegionName,
             color = RegionName)) +
  geom_line() +
  geom_point(data = bombing_points, color = "black", size = 1.5) + 
  labs(title = "Average Boston House Sale Price by Month",
      x = "",
      y = "Sale Price", 
      caption = "Graph by Hannah, Jonah, & Jon, data from Zillow") +
  theme(legend.position = "none")

boston_bombing
```



